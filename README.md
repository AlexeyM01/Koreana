# Пользовательская аутентификация и управление

## Назначение проекта

Этот проект представляет собой бэкенд-приложение, разработанное на фреймворке FastAPI. Приложение предоставляет API для аутентификации пользователей (регистрация, логин, обновление токенов), управления ролями и перевода текста с использованием Yandex Translate API. В проекте реализована интеграция с базами данных PostgreSQL и Redis для хранения данных и кэширования. Также реализованы механизмы логирования, rate limiting и обработка исключений.
## Технологии

•  Python
•  FastAPI
•  SQLAlchemy
•  asyncpg
•  uvicorn
•  python-dotenv
•  passlib
•  PyJWT
•  redis
•  requests
•  slowapi
•  pytest

## Шаги по установке, сборке, запуску

1. **Клонирование репозитория**:
   ```bash
   git clone https://github.com/AlexeyM01/Koreana.git
   cd Koreana
   ```

2. **Создание и активация виртуального окружения**:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Для Linux и MacOS
   venv\Scripts\activate  # Для Windows
   ```

3. **Установка зависимостей**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Настройка переменных окружения: Создайте файл .env в корне проекта и добавьте необходимые переменные**:
```
SECRET_KEY=
ALGORITHM=
ACCESS_TOKEN_EXPIRE_MINUTES=
REFRESH_TOKEN_EXPIRE_MINUTES=
DB_NAME=
DB_USER=
DB_PASSWORD=
DB_HOST=
DB_PORT=

REDIS_HOST=redis://redis
REDIS_PORT=6379

YANDEX_TRANSLATE_API_KEY=
YANDEX_TRANSLATE_FOLDER_ID=

DEBUG=False
```

5. **Инициализация базы данных: Убедитесь, что PostgreSQL и Redis запущены, затем инициализируйте базу данных, выполнив команду**:
```bash
python -m main 
```

6.1. **Локальный запуск приложения с помощью Uvicorn**:
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload --log-level info
```

6.2. **Запуск приложения с помощью Docker**:
```bash
docker-compose up -d --build --verbose
```
Это запустит приложение и все необходимые сервисы (PostgreSQL, Redis) в контейнерах.

7. **Доступ к API**: После запуска приложение будет доступно по адресу http://localhost:8000. 
Перейдите по этому адресу для доступа к автоматически сгенерированной документации API (Swagger UI):
http://localhost:8000/docs

8. Эндпоинты API

•  Аутентификация:
  •  POST /registration/: Регистрация пользователя.
  •  POST /login/: Аутентификация пользователя и получение токенов.
  •  GET /me: Получение информации о текущем пользователе (требуется токен).
  •  PUT /me: Обновление информации о текущем пользователе (требуется токен).
  •  POST /refresh/: Обновление access token с использованием refresh token.
  •  GET /get_tokens: Получение токенов из cookie

•  Роли:
  •  POST /roles/: Создание роли (требуются права администратора).
  •  GET /roles/{role_id}: Получение роли по ID (требуются права администратора).
  •  PUT /roles/{role_id}: Обновление роли по ID (требуются права администратора).
  •  DELETE /roles/{role_id}: Удаление роли по ID (требуются права администратора).
  •  GET /roles/: Получение списка всех ролей (требуются права администратора).
  •  PUT /roles/user/{user_id}/role/{role_id}: Присвоение роли пользователю (требуются права администратора).

•  Перевод:
  •  POST /translate/: Перевод текста с использованием Yandex Translate API.

•  Прочее:
  •  GET /db-status: Проверка соединения с базой данных.
  •  GET /ws/tasks/: WebSocket endpoint для взаимодействия с клиентом.

▌Логирование

Логирование настроено через файл logging.conf. По умолчанию логи записываются в консоль и в файл logs/app.log.

▌Rate Limiting

Используется библиотека slowapi для ограничения количества запросов к API.
По умолчанию установлено ограничение 20 запросов в минуту для неавторизованных пользователей и другие ограничения для определенных endpoints.

▌Обработка исключений

Приложение обрабатывает исключения валидации запросов и общие исключения, возвращая JSON-ответы с информацией об ошибке.